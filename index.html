<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <!-- use a release build and load as a module -->
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.2.1/core.css" />
    <script type="module" src="https://pyscript.net/releases/2024.2.1/core.js"></script>
    <title>Posturography - PyScript</title>
    <style>body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:20px}</style>
  </head>
  <body>
    <h1>Posturography CSV Viewer</h1>

    <input id="csv_file" type="file" accept=".csv" />
    <button id="load_button">Load & Analyze</button>

    <div id="results" style="margin-top:1rem"></div>

    <py-config>
    packages = ["pandas", "matplotlib", "numpy"]
    paths = ["."]
    </py-config>

    <py-script output="results">
    import sys, asyncio
    from js import document, fetch
    from pyodide.ffi import create_proxy

    results_div = document.getElementById("results")

    async def setup():
        try:
            # fetch posture9.py from the HTTP server
            resp = await fetch("posture9.py")
            if resp.status != 200:
                results_div.innerHTML = f"Error: posture9.py not found on server (HTTP {resp.status})"
                return
            
            # read the file content
            text = await resp.text()
            
            # write to Pyodide's virtual filesystem
            with open("posture9.py", "w") as f:
                f.write(text)
            
            print("Fetched and wrote posture9.py to virtual FS")
            
            # now import it
            import posture9
            print("posture9 imported successfully")
            
            # bind button
            document.getElementById("load_button").addEventListener("click", create_proxy(posture9.load_csv))
            print("Bound load_button to posture9.load_csv")
            results_div.innerHTML = "Ready â€” select CSV and click Load & Analyze"
            
        except Exception as e:
            results_div.innerHTML = f"Setup failed: {e}"
            print("Error:", e)
            import traceback
            traceback.print_exc()

    # run async setup
    asyncio.create_task(setup())
    </py-script>

  </body>
</html>